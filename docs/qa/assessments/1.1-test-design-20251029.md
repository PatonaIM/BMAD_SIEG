# Test Design: Story 1.1 - Project Initialization & Monorepo Setup

**Date:** 2025-10-29  
**Designer:** Quinn (Test Architect)  
**Story:** 1.1.project-init  
**Status:** Draft Review

## Test Strategy Overview

- **Total test scenarios:** 24
- **Unit tests:** 8 (33%)
- **Integration tests:** 12 (50%)
- **E2E tests:** 4 (17%)
- **Priority distribution:** P0: 8, P1: 12, P2: 4, P3: 0

**Rationale:** Foundation story with emphasis on integration testing to validate tool configurations, package installations, and system interactions. Unit tests focus on isolated components (health endpoints, validation). E2E tests validate critical developer workflows.

---

## Test Scenarios by Acceptance Criteria

### AC1: Monorepo created with separate `/frontend` and `/backend` directories

**Risk:** Project structure errors block all development

#### Scenarios

| ID           | Level       | Priority | Test                               | Justification                                |
| ------------ | ----------- | -------- | ---------------------------------- | -------------------------------------------- |
| 1.1-INT-001  | Integration | P0       | Verify `/frontend` directory exists | Structural validation requires filesystem    |
| 1.1-INT-002  | Integration | P0       | Verify `/backend` directory exists  | Structural validation requires filesystem    |
| 1.1-INT-003  | Integration | P1       | Verify obsolete files removed       | File cleanup validation                      |
| 1.1-INT-004  | Integration | P2       | Verify `template-setup/` preserved  | Optional - documents team onboarding process |

---

### AC2: Frontend initialized with React 18+ TypeScript, Material-UI, and essential dependencies

**Risk:** Missing dependencies cause runtime failures; version mismatches create compatibility issues

#### Scenarios

| ID           | Level       | Priority | Test                                           | Justification                              |
| ------------ | ----------- | -------- | ---------------------------------------------- | ------------------------------------------ |
| 1.1-INT-005  | Integration | P0       | Verify `package.json` contains required deps   | Dependency validation requires npm context |
| 1.1-INT-006  | Integration | P0       | Verify React version >= 18.0.0                 | Version constraint critical                |
| 1.1-INT-007  | Integration | P0       | Verify TypeScript configured in `tsconfig.json`| Build tool validation                      |
| 1.1-INT-008  | Integration | P1       | Verify Vite builds without errors              | Full build pipeline test                   |
| 1.1-INT-009  | Integration | P1       | Verify MUI imports resolve                     | UI library integration                     |
| 1.1-INT-010  | Integration | P1       | Verify TanStack Query configured               | State management setup                     |

---

### AC3: Backend initialized with FastAPI Python 3.11.9, project structure following best practices

**Risk:** Wrong Python version causes runtime incompatibility; missing structure blocks development

#### Scenarios

| ID           | Level       | Priority | Test                                          | Justification                           |
| ------------ | ----------- | -------- | --------------------------------------------- | --------------------------------------- |
| 1.1-INT-011  | Integration | P0       | Verify Python version is 3.11.9               | Version-specific features/compatibility |
| 1.1-INT-012  | Integration | P0       | Verify `requirements.txt` with core deps      | Dependency management validation        |
| 1.1-INT-013  | Integration | P0       | Verify backend directory structure complete   | Architectural compliance                |
| 1.1-INT-014  | Integration | P1       | Verify UV package manager installed           | Build tool availability                 |
| 1.1-INT-015  | Integration | P1       | Verify FastAPI imports without errors         | Framework installation validation       |

---

### AC4: Git repository initialized with `.gitignore` configured

**Risk:** Committed secrets or build artifacts pollute repository

#### Scenarios

| ID           | Level       | Priority | Test                                      | Justification                      |
| ------------ | ----------- | -------- | ----------------------------------------- | ---------------------------------- |
| 1.1-UNIT-001 | Unit        | P0       | Verify `.gitignore` contains Python patterns | Pattern matching - pure logic   |
| 1.1-UNIT-002 | Unit        | P0       | Verify `.gitignore` contains Node patterns| Pattern matching - pure logic      |
| 1.1-INT-016  | Integration | P1       | Verify `.env` files are git-ignored       | Git integration behavior           |
| 1.1-INT-017  | Integration | P1       | Verify `node_modules/` is git-ignored     | Git integration behavior           |

---

### AC5: README.md with project overview, setup instructions, and development guidelines

**Risk:** Poor documentation blocks onboarding and increases support burden

#### Scenarios

| ID           | Level       | Priority | Test                                         | Justification                     |
| ------------ | ----------- | -------- | -------------------------------------------- | --------------------------------- |
| 1.1-UNIT-003 | Unit        | P1       | Verify README contains all required sections | Content validation - text parsing |
| 1.1-UNIT-004 | Unit        | P1       | Verify README has setup commands             | Content validation - text parsing |
| 1.1-E2E-001  | E2E         | P1       | Developer follows README setup successfully  | Critical onboarding workflow      |

---

### AC6: Package managers configured (npm for frontend, UV for backend)

**Risk:** Package installation failures block development

#### Scenarios

| ID           | Level       | Priority | Test                                        | Justification                        |
| ------------ | ----------- | -------- | ------------------------------------------- | ------------------------------------ |
| 1.1-INT-018  | Integration | P0       | Verify `npm install` completes successfully | npm integration with package.json    |
| 1.1-INT-019  | Integration | P0       | Verify `uv pip install` completes           | UV integration with requirements.txt |
| 1.1-E2E-002  | E2E         | P0       | Fresh clone -> install -> no errors         | Complete setup workflow              |

---

### AC7: Environment variable management setup

**Risk:** Missing env templates cause configuration errors; hardcoded secrets leaked

#### Scenarios

| ID           | Level       | Priority | Test                                           | Justification                     |
| ------------ | ----------- | -------- | ---------------------------------------------- | --------------------------------- |
| 1.1-UNIT-005 | Unit        | P0       | Verify backend `.env.example` has required vars| Content validation - text parsing |
| 1.1-UNIT-006 | Unit        | P0       | Verify frontend `.env.example` has required vars| Content validation - text parsing|
| 1.1-INT-020  | Integration | P1       | Verify backend loads env vars from `.env`      | Config loading integration        |
| 1.1-INT-021  | Integration | P1       | Verify frontend loads Vite env vars            | Build tool env integration        |

---

### AC8: Basic health check endpoints work

**Risk:** Infrastructure misconfiguration prevents service startup

#### Scenarios

| ID           | Level       | Priority | Test                                              | Justification                          |
| ------------ | ----------- | -------- | ------------------------------------------------- | -------------------------------------- |
| 1.1-UNIT-007 | Unit        | P0       | Backend health endpoint returns correct structure | Pure response validation               |
| 1.1-UNIT-008 | Unit        | P0       | Frontend HealthCheckPage renders correctly        | Component rendering - isolated         |
| 1.1-INT-022  | Integration | P0       | Backend `/health` responds with 200               | FastAPI + uvicorn integration          |
| 1.1-INT-023  | Integration | P0       | Frontend fetches backend health successfully      | Cross-service HTTP integration         |
| 1.1-E2E-003  | E2E         | P0       | Start both services -> health check shows green   | Critical developer workflow            |
| 1.1-E2E-004  | E2E         | P1       | Health check auto-refreshes every 30s             | User experience validation             |

---

## Cross-Cutting Test Scenarios

### Linting & Formatting (Related to Task 7)

| ID           | Level       | Priority | Test                                    | Justification                 |
| ------------ | ----------- | -------- | --------------------------------------- | ----------------------------- |
| 1.1-INT-024  | Integration | P2       | Backend `ruff check` passes             | Tool integration validation   |
| 1.1-INT-025  | Integration | P2       | Frontend `npm run lint` passes          | Tool integration validation   |

---

## Test Execution Plan

### Phase 1: Critical Path (P0) - Must Pass Before PR

1. **Structure & Dependencies (INT-001, INT-002, INT-005, INT-006, INT-007, INT-011, INT-012, INT-013)**
   - Verify monorepo structure
   - Validate package installations
   - Confirm Python/Node versions

2. **Configuration (UNIT-001, UNIT-002, UNIT-005, UNIT-006)**
   - Validate .gitignore patterns
   - Verify .env.example templates

3. **Health Checks (UNIT-007, INT-022, INT-023, E2E-003)**
   - Unit test health endpoint logic
   - Integration test API responses
   - E2E test full health check flow

4. **Package Management (INT-018, INT-019, E2E-002)**
   - Test fresh installation workflow

### Phase 2: Core Functionality (P1) - Should Pass Before Merge

5. **Build & Import Validation (INT-008, INT-009, INT-010, INT-014, INT-015)**
   - Verify frontend builds
   - Verify library imports

6. **Git Integration (INT-016, INT-017)**
   - Test .gitignore behavior

7. **Documentation & Onboarding (UNIT-003, UNIT-004, E2E-001)**
   - Validate README completeness
   - Test developer onboarding

8. **Environment Loading (INT-020, INT-021)**
   - Test env var loading

### Phase 3: Polish (P2) - Nice to Have

9. **Tool Configuration (INT-024, INT-025)**
   - Verify linting setup

10. **Optional Structure (INT-003, INT-004)**
    - Validate cleanup

---

## Risk Coverage Mapping

| Risk ID   | Description                          | Mitigated By                                    |
| --------- | ------------------------------------ | ----------------------------------------------- |
| RISK-001  | Wrong Python version                 | 1.1-INT-011                                     |
| RISK-002  | Missing dependencies                 | 1.1-INT-005, 1.1-INT-012, E2E-002               |
| RISK-003  | Build failures                       | 1.1-INT-008, 1.1-INT-015                        |
| RISK-004  | Configuration errors                 | 1.1-UNIT-005, 1.1-UNIT-006, INT-020, INT-021    |
| RISK-005  | Infrastructure misconfiguration      | 1.1-INT-022, 1.1-INT-023, E2E-003               |
| RISK-006  | Poor onboarding experience           | E2E-001, E2E-002                                |
| RISK-007  | Committed secrets                    | 1.1-UNIT-001, 1.1-UNIT-002, INT-016             |

---

## Coverage Analysis

### By Acceptance Criteria

| AC  | Unit | Integration | E2E | Total | Status   |
| --- | ---- | ----------- | --- | ----- | -------- |
| AC1 | 0    | 4           | 0   | 4     | ✓ Covered|
| AC2 | 0    | 6           | 0   | 6     | ✓ Covered|
| AC3 | 0    | 5           | 0   | 5     | ✓ Covered|
| AC4 | 2    | 2           | 0   | 4     | ✓ Covered|
| AC5 | 2    | 0           | 1   | 3     | ✓ Covered|
| AC6 | 0    | 2           | 1   | 3     | ✓ Covered|
| AC7 | 2    | 2           | 0   | 4     | ✓ Covered|
| AC8 | 2    | 2           | 2   | 6     | ✓ Covered|

**Coverage Gaps:** None - all ACs have test coverage

### Test Pyramid Health

```
         E2E (4)        17% - Appropriate for infrastructure story
       ┌────────┐
      Integration      50% - Heavy integration due to tool setup
     ┌────────────┐
    Unit (8)          33% - Limited pure logic in setup story
   ┌──────────────┐
```

**Assessment:** Healthy distribution for infrastructure story. Higher integration % expected due to package manager, build tool, and server startup validation.

---

## Implementation Notes

### Backend Test Setup (`backend/tests/`)

**conftest.py:**
```python
import pytest
from fastapi.testclient import TestClient
from main import app

@pytest.fixture
def client():
    return TestClient(app)

@pytest.fixture
def mock_env(monkeypatch):
    monkeypatch.setenv("DATABASE_URL", "postgresql://test")
    monkeypatch.setenv("JWT_SECRET", "test-secret-key-min-32-characters")
```

**tests/unit/test_health_endpoint.py:**
```python
def test_health_endpoint_structure(client):
    response = client.get("/health")
    assert response.status_code == 200
    data = response.json()
    assert "status" in data
    assert "version" in data
    assert data["status"] == "healthy"
```

### Frontend Test Setup (`frontend/tests/`)

**setup.ts:**
```typescript
import '@testing-library/jest-dom'
import { expect, afterEach } from 'vitest'
import { cleanup } from '@testing-library/react'

afterEach(() => {
  cleanup()
})
```

**HealthCheckPage.test.tsx:**
```typescript
import { render, screen, waitFor } from '@testing-library/react'
import HealthCheckPage from '@/pages/HealthCheckPage'

test('renders health check page', () => {
  render(<HealthCheckPage />)
  expect(screen.getByText(/health/i)).toBeInTheDocument()
})
```

---

## Recommended Test Execution Commands

### Backend
```bash
# All tests
pytest backend/tests/

# Unit only
pytest backend/tests/unit/

# With coverage
pytest backend/tests/ --cov=app --cov-report=html

# Watch mode (requires pytest-watch)
ptw backend/tests/
```

### Frontend
```bash
# All tests
npm run test

# With UI
npm run test:ui

# With coverage
npm run test:coverage

# Watch mode (default for vitest)
npm run test
```

### E2E Validation
```bash
# Manual E2E validation checklist
# 1. Fresh clone
git clone <repo> test-clone && cd test-clone

# 2. Follow README setup
# (execute documented commands)

# 3. Start services
cd backend && uvicorn main:app --reload &
cd frontend && npm run dev &

# 4. Verify health check
curl http://localhost:8000/health
open http://localhost:3000
```

---

## Quality Checklist

- [x] Every AC has test coverage
- [x] Test levels are appropriate (not over-testing)
- [x] No duplicate coverage across levels
- [x] Priorities align with business risk
- [x] Test IDs follow naming convention (1.1-{LEVEL}-{SEQ})
- [x] Scenarios are atomic and independent
- [x] Risk coverage documented
- [x] Execution order optimized (P0 → P1 → P2)

---

## Gate YAML Block

```yaml
test_design:
  scenarios_total: 27
  by_level:
    unit: 8
    integration: 15
    e2e: 4
  by_priority:
    p0: 8
    p1: 15
    p2: 4
    p3: 0
  coverage_gaps: []
  risk_coverage:
    - RISK-001: Python version validation
    - RISK-002: Dependency installation
    - RISK-003: Build pipeline
    - RISK-004: Configuration management
    - RISK-005: Service startup
    - RISK-006: Developer onboarding
    - RISK-007: Secret exposure
```

---

## Next Steps

1. **Implement P0 tests** during development (TDD approach)
2. **Run P0 tests** before PR creation
3. **Execute full suite** in CI pipeline
4. **Update test design** if ACs change during implementation
5. **Feed results** to trace-requirements task for Given-When-Then mapping

---

**Test Design Complete** ✓  
Ready for implementation and quality gate review.
