# Risk Profile: Story 1.3 - Authentication & Candidate Session Management

**Date:** 2025-10-29  
**Reviewer:** Quinn (Test Architect)  
**Story:** 1.3 - Authentication & Candidate Session Management

---

## Executive Summary

**Total Risks Identified:** 18  
**Critical Risks:** 3  
**High Risks:** 4  
**Medium Risks:** 7  
**Low Risks:** 4  
**Overall Risk Score:** 43/100 (HIGH RISK - Significant mitigation required)

This authentication story carries **HIGH RISK** due to security-critical functionality. Three critical risks require immediate attention: JWT secret management, password storage security, and XSS vulnerabilities. The story implements foundational security controls that will protect all future features.

---

## Critical Risks Requiring Immediate Attention

### 1. SEC-001: Weak or Missing JWT Secret Configuration

**Score: 9 (Critical)**  
**Category:** Security  
**Probability:** High (3) - Developers often use weak secrets during development that persist to production  
**Impact:** High (3) - Complete authentication bypass, impersonation attacks, unauthorized access to all user data

**Description:**  
JWT tokens are only as secure as the signing secret. If the JWT_SECRET is weak (<32 characters), predictable, or defaults to a common value, attackers can forge valid tokens and impersonate any user.

**Affected Components:**
- `app/core/security.py` - Token generation/verification
- `app/core/config.py` - Secret loading
- `.env` configuration files

**Detection Method:**  
Code review reveals JWT_SECRET loaded from environment but no validation of secret strength.

**Mitigation Strategy:** Preventive
- ✅ **Validate secret strength in config:** Add Pydantic validator requiring ≥32 characters
- ✅ **Generate cryptographically secure secret:** Use `python -c "import secrets; print(secrets.token_urlsafe(32))"` 
- ✅ **Document secret generation:** Add to story dev notes (already present)
- ✅ **Environment variable checks:** Raise ValueError if JWT_SECRET not set or too short
- ⚠️ **Secret rotation policy:** Document process for rotating JWT secrets (future enhancement)

**Testing Requirements:**
- Unit test: `test_jwt_secret_too_short_raises_error()` - Verify config validation
- Unit test: `test_jwt_secret_missing_raises_error()` - Verify required field enforcement
- Integration test: Token forgery attempt with weak secret (security test)

**Residual Risk:** Low - After validation, risk limited to secret compromise through other means (key leak, insider threat)  
**Owner:** Dev Team  
**Timeline:** Before first deployment (Story 1.3 completion)

---

### 2. SEC-002: Password Hashing Implementation Defects

**Score: 9 (Critical)**  
**Category:** Security  
**Probability:** Medium (2) - Bcrypt is well-documented but implementation errors common  
**Impact:** High (3) - Password database breach would expose all user credentials

**Description:**  
Incorrect bcrypt implementation (wrong cost factor, missing salt, timing attacks) could weaken password protection. Cost factor too low = vulnerable to brute force. Cost factor too high = DOS via CPU exhaustion.

**Affected Components:**
- `app/core/security.py` - `hash_password()`, `verify_password()`
- `app/services/auth_service.py` - Password validation logic
- `app/models/candidate.py` - `password_hash` field (255 char limit)

**Detection Method:**  
Code review and security testing required to validate bcrypt configuration.

**Mitigation Strategy:** Preventive + Detective
- ✅ **Use passlib CryptContext:** Industry-standard library with secure defaults
- ✅ **Set cost factor to 12:** Balances security and performance (documented in story)
- ✅ **Verify salt uniqueness:** Test that same password generates different hashes
- ✅ **Timing attack protection:** Passlib includes constant-time comparison
- ⚠️ **Password complexity rules:** Min 8 chars (consider strengthening to 10+ chars)
- ⚠️ **Failed login monitoring:** Track attempts for rate limiting (future: SlowAPI)

**Testing Requirements:**
- Unit test: `test_hash_password_returns_different_hash_each_time()` - Verify salt randomness
- Unit test: `test_verify_password_validates_correct_password()` - Positive case
- Unit test: `test_verify_password_rejects_incorrect_password()` - Negative case
- Unit test: `test_password_hash_field_length_sufficient()` - Verify 255 chars enough for bcrypt
- Integration test: Register with weak password (should fail validation)
- Security test: Attempt timing attack on verify_password (manual)

**Residual Risk:** Low - Bcrypt with cost factor 12 is industry standard; risk limited to future cryptographic breaks  
**Owner:** Dev Team  
**Timeline:** Before Story 1.3 completion (blocking acceptance criteria)

---

### 3. SEC-003: XSS Vulnerabilities in Auth Forms

**Score: 9 (Critical)**  
**Category:** Security  
**Probability:** High (3) - Frontend forms without sanitization are common XSS vectors  
**Impact:** High (3) - Session hijacking, credential theft, malicious script injection

**Description:**  
User inputs in LoginForm and RegisterForm (email, full_name) rendered without sanitization could execute malicious scripts. Even though auth forms seem low-risk for XSS, email addresses with embedded scripts or names like `<script>alert('XSS')</script>` could persist to database and execute later in admin dashboards or recruiter views.

**Affected Components:**
- `frontend/src/features/auth/components/RegisterForm/RegisterForm.tsx`
- `frontend/src/features/auth/components/LoginForm/LoginForm.tsx`
- Backend: `app/schemas/auth.py` - Input validation schemas

**Detection Method:**  
Security testing with OWASP ZAP / manual XSS payload injection.

**Mitigation Strategy:** Preventive + Detective
- ✅ **Content Security Policy (CSP) headers:** Prevent inline script execution
- ✅ **React auto-escaping:** React escapes by default (verify no `dangerouslySetInnerHTML`)
- ✅ **Backend input validation:** Pydantic EmailStr validates email format
- ✅ **Frontend validation:** react-hook-form with pattern validation
- ⚠️ **Sanitize full_name on backend:** Strip HTML tags from name field
- ⚠️ **Output encoding:** Verify Material-UI TextField doesn't render HTML

**Testing Requirements:**
- Unit test: `test_register_form_escapes_script_tags()` - Frontend component test
- Integration test: Register with XSS payload in full_name (should be sanitized or rejected)
- Security test: OWASP ZAP scan on auth endpoints
- Manual test: Submit `<script>alert('XSS')</script>` as full_name

**Residual Risk:** Low - React's auto-escaping + CSP headers + backend validation provide defense in depth  
**Owner:** Dev Team  
**Timeline:** Before Story 1.3 completion

---

## High Risks Requiring Mitigation

### 4. SEC-004: JWT Token Exposure in LocalStorage

**Score: 6 (High)**  
**Category:** Security  
**Probability:** Medium (2) - LocalStorage accessible to all scripts on same origin  
**Impact:** High (3) - XSS attack can steal token and impersonate user

**Description:**  
Story requires storing JWT in `localStorage` (per architecture docs). If XSS vulnerability exists elsewhere in app, attacker can access token via `localStorage.getItem('auth_token')`. Industry best practice is httpOnly cookies, but architecture decision already made.

**Mitigation Strategy:** Detective + Corrective
- ⚠️ **Accept architectural risk:** LocalStorage chosen for simplicity (documented)
- ✅ **Short token expiration:** 24 hours limits exposure window
- ✅ **CSP headers:** Prevent XSS that could steal token
- ⚠️ **Future enhancement:** Consider httpOnly cookies for production (note in tech debt)
- ✅ **Token refresh mechanism:** Implement in future story for shorter access tokens

**Testing Requirements:**
- Manual test: Verify token expires after 24 hours
- Security test: Attempt token theft via simulated XSS

**Residual Risk:** Medium - LocalStorage risk mitigated by XSS prevention, but not eliminated  
**Owner:** Dev Team (accepted risk)  
**Timeline:** Acknowledged for Story 1.3; revisit in Epic 2

---

### 5. SEC-005: Missing Rate Limiting on Auth Endpoints

**Score: 6 (High)**  
**Category:** Security  
**Probability:** High (3) - Rate limiting not implemented in Story 1.3  
**Impact:** Medium (2) - Brute force attacks on login, credential stuffing, DOS

**Description:**  
Without rate limiting, attackers can make unlimited login attempts to guess passwords. Even with bcrypt (slow hashing), distributed attacks or credential stuffing can succeed.

**Affected Components:**
- `app/api/v1/auth.py` - Login and register endpoints
- Future: SlowAPI middleware (documented but not in scope)

**Mitigation Strategy:** Corrective (Future Enhancement)
- ⚠️ **Not in MVP scope:** Story notes rate limiting as future enhancement
- ⚠️ **Manual monitoring:** Watch for suspicious login patterns in logs
- ⚠️ **Database load monitoring:** High login volume will show in metrics
- ✅ **Document for Epic 2:** Add rate limiting story to backlog

**Testing Requirements:**
- Load test: Verify system handles 100 login attempts/second (performance baseline)
- Manual test: Document current behavior without rate limiting

**Residual Risk:** High - Until rate limiting implemented, vulnerable to brute force  
**Owner:** Product Owner (backlog priority)  
**Timeline:** Epic 2 (post-MVP)

---

### 6. DATA-001: JWT Secret Exposure in Logs/Error Messages

**Score: 6 (High)**  
**Category:** Data Security  
**Probability:** Medium (2) - Common error: logging config values during debugging  
**Impact:** High (3) - Secret leak allows token forgery

**Description:**  
If JWT_SECRET accidentally logged (error handling, debug statements, exception traces), attackers gaining log access can forge tokens. Similar risk with `.env` files committed to git.

**Mitigation Strategy:** Preventive
- ✅ **Never log secrets:** Code review checklist item
- ✅ **Gitignore .env:** Already configured in Story 1.2
- ✅ **Exception handling:** Avoid printing full config in error messages
- ✅ **Mask secrets in logs:** If logging config, redact sensitive fields
- ⚠️ **Secret scanning:** Consider GitHub secret scanning (future)

**Testing Requirements:**
- Manual test: Trigger authentication errors and verify JWT_SECRET not in logs
- Code review: Search for `print(settings)` or `logger.debug(config)`

**Residual Risk:** Low - With proper logging practices, risk minimal  
**Owner:** Dev Team  
**Timeline:** During Story 1.3 development

---

### 7. TECH-001: BaseRepository Pattern Implementation Complexity

**Score: 6 (High)**  
**Category:** Technical  
**Probability:** High (3) - First time implementing generic repository pattern  
**Impact:** Medium (2) - Bugs in base class affect all repositories

**Description:**  
BaseRepository introduces generics (TypeVar), async patterns, and SQLAlchemy abstractions. Implementation errors will cascade to CandidateRepository and all future repositories. Common issues: incorrect type hints, async/await errors, transaction handling bugs.

**Affected Components:**
- `app/repositories/base.py` - Abstract base class
- `app/repositories/candidate.py` - First concrete implementation
- All future repositories inherit from BaseRepository

**Mitigation Strategy:** Preventive
- ✅ **Follow documented pattern:** Dev notes include full BaseRepository interface
- ✅ **Comprehensive unit tests:** Mock AsyncSession and test all base methods
- ✅ **Type checking:** Use mypy to verify generic types
- ✅ **Code review focus:** Extra attention to async/await and type hints
- ✅ **Simple first implementation:** CandidateRepository tests the pattern

**Testing Requirements:**
- Unit test: `test_base_repository_get_by_id()` - Mock database interaction
- Unit test: `test_base_repository_create()` - Verify flush and refresh
- Unit test: `test_base_repository_delete()` - Test deletion logic
- Integration test: CandidateRepository CRUD operations

**Residual Risk:** Low - Pattern is well-documented and testable  
**Owner:** Dev Team  
**Timeline:** Task 1 of Story 1.3

---

## Medium Risks Requiring Attention

### 8. TECH-002: JWT Token Expiration Edge Cases

**Score: 4 (Medium)**  
**Category:** Technical  
**Probability:** Medium (2) - Token expiration timing is tricky  
**Impact:** Medium (2) - Users logged out unexpectedly or expired tokens accepted

**Description:**  
JWT expiration checks must handle clock skew, timezone differences, and race conditions. If token expires mid-request, user gets 401 error without warning.

**Mitigation:**
- ✅ **Use UTC timestamps:** `datetime.utcnow()` for consistency
- ✅ **PyJWT handles expiration:** Library verifies 'exp' claim automatically
- ⚠️ **Grace period for refresh:** Future enhancement (token refresh)
- ✅ **Frontend token check:** Verify token valid before API calls (optional)

**Testing Requirements:**
- Unit test: `test_verify_token_rejects_expired_jwt()` - Mock time.now()
- Integration test: Use token after 24 hours (should fail)

**Residual Risk:** Low  
**Owner:** Dev Team  
**Timeline:** Task 2 (Auth Service)

---

### 9. SEC-006: SQL Injection via Repository Pattern

**Score: 4 (Medium)**  
**Category:** Security  
**Probability:** Low (1) - SQLAlchemy ORM prevents SQL injection by default  
**Impact:** High (3) - Database compromise if injection succeeds

**Description:**  
Though SQLAlchemy parameterizes queries, incorrect use of raw SQL or string concatenation in repositories could introduce SQL injection. Example: `session.execute(f"SELECT * FROM candidates WHERE email = '{email}'")` (incorrect).

**Mitigation:**
- ✅ **Use ORM methods only:** No raw SQL in repositories (per coding standards)
- ✅ **Documented pattern:** Dev notes show safe query examples
- ✅ **Code review:** Reject any raw SQL with string formatting
- ✅ **SQLAlchemy Core:** If raw SQL needed, use parameterized queries

**Testing Requirements:**
- Security test: Attempt SQL injection payloads in email field
- Code review: Search for `.execute(f"` patterns

**Residual Risk:** Very Low  
**Owner:** Dev Team  
**Timeline:** Task 1 (BaseRepository)

---

### 10. PERF-001: Bcrypt Hashing Performance Impact

**Score: 4 (Medium)**  
**Category:** Performance  
**Probability:** Medium (2) - Cost factor 12 is intentionally slow  
**Impact:** Medium (2) - Slow login/registration response times

**Description:**  
Bcrypt with cost factor 12 takes ~200-300ms per hash. Under load (100 concurrent registrations), could saturate CPU. This is intentional (security vs performance tradeoff).

**Mitigation:**
- ✅ **Async implementation:** FastAPI async routes don't block other requests
- ✅ **Acceptable for MVP:** Candidate registration is infrequent
- ⚠️ **Load testing required:** Verify 10 concurrent logins acceptable
- ⚠️ **Future optimization:** Consider Argon2 or async hashing workers

**Testing Requirements:**
- Load test: 50 concurrent login attempts (measure response time)
- Performance test: Measure single hash operation (~250ms expected)

**Residual Risk:** Low - Acceptable for MVP scale  
**Owner:** Dev Team  
**Timeline:** Task 11 (Integration Tests)

---

### 11. DATA-002: Email Uniqueness Race Condition

**Score: 4 (Medium)**  
**Category:** Data Integrity  
**Probability:** Low (1) - Requires precise timing of concurrent requests  
**Impact:** High (3) - Duplicate accounts created, data integrity violated

**Description:**  
Two concurrent registration requests with same email could both pass `get_by_email()` check before either commits, resulting in duplicate records despite unique constraint.

**Mitigation:**
- ✅ **Database unique constraint:** PostgreSQL enforces uniqueness at DB level
- ✅ **Handle IntegrityError:** Catch SQLAlchemy exception and return 400
- ✅ **Race condition caught by DB:** Even if app logic fails, database prevents duplicates
- ✅ **Test concurrent requests:** Integration test with parallel registrations

**Testing Requirements:**
- Integration test: Concurrent registration with same email (should fail one)
- Unit test: AuthService handles IntegrityError gracefully

**Residual Risk:** Very Low  
**Owner:** Dev Team  
**Timeline:** Task 4 (Auth API Routes)

---

### 12. OPS-001: Missing Authentication Error Monitoring

**Score: 4 (Medium)**  
**Category:** Operational  
**Probability:** High (3) - No monitoring implemented in Story 1.3  
**Impact:** Low (1) - Can't detect attacks or issues, but system still functions

**Description:**  
Failed login attempts, expired tokens, and invalid credentials won't be tracked or alerted. Security incidents (credential stuffing, brute force) will go unnoticed until manual log review.

**Mitigation:**
- ⚠️ **Basic logging:** Log authentication failures with FastAPI logging
- ⚠️ **Future monitoring:** Sentry integration in Epic 2 for error tracking
- ⚠️ **Metrics dashboard:** Track login success/failure rates (future)
- ⚠️ **Alerting rules:** Define thresholds for suspicious activity (future)

**Testing Requirements:**
- Manual test: Verify failed login logged with timestamp and email
- Manual test: Verify successful login logged (optional for privacy)

**Residual Risk:** Medium - Can't detect attacks quickly  
**Owner:** Product Owner (backlog)  
**Timeline:** Epic 2

---

### 13. BUS-001: Password Reset Not Implemented

**Score: 4 (Medium)**  
**Category:** Business  
**Probability:** High (3) - Users will forget passwords  
**Impact:** Low (1) - Support burden, user frustration, but workaround exists

**Description:**  
Story 1.3 doesn't include password reset functionality. Users who forget passwords have no self-service recovery, requiring manual admin intervention.

**Mitigation:**
- ⚠️ **Acknowledged gap:** Not in MVP scope
- ⚠️ **Manual workaround:** Admins can reset passwords in database (not scalable)
- ⚠️ **Prioritize for Epic 2:** Add password reset story to backlog
- ⚠️ **Document limitation:** Include in release notes

**Testing Requirements:**
- None (feature not implemented)

**Residual Risk:** Medium - User experience gap  
**Owner:** Product Owner  
**Timeline:** Epic 2

---

### 14. TECH-003: Frontend Auth State Synchronization

**Score: 4 (Medium)**  
**Category:** Technical  
**Probability:** Medium (2) - Zustand store and localStorage can desync  
**Impact:** Medium (2) - Users appear logged in but tokens invalid

**Description:**  
JWT stored in both `localStorage` and Zustand store (`authStore.ts`). If token expires or user logs out in another tab, state may desync. User sees authenticated UI but API calls fail with 401.

**Mitigation:**
- ✅ **Centralize token access:** Always read from localStorage, not store
- ✅ **401 handling:** Redirect to login on token expiration
- ⚠️ **Storage events:** Listen for localStorage changes (multi-tab sync)
- ✅ **Token validation on load:** Check token validity on app initialization

**Testing Requirements:**
- Manual test: Open two tabs, logout in one, verify other tab redirects
- Manual test: Wait 24 hours, verify auto-logout on token expiration

**Residual Risk:** Low  
**Owner:** Dev Team  
**Timeline:** Task 8 (Frontend Auth Service)

---

### 15. SEC-007: CORS Misconfiguration Risk

**Score: 4 (Medium)**  
**Category:** Security  
**Probability:** Medium (2) - CORS setup is error-prone  
**Impact:** Medium (2) - Unauthorized cross-origin requests or legitimate requests blocked

**Description:**  
Incorrect CORS configuration could either allow malicious sites to make authenticated requests (too permissive) or block legitimate frontend requests (too restrictive).

**Mitigation:**
- ✅ **Restrict origins:** Only allow frontend origin (http://localhost:5173 dev, production domain)
- ✅ **Credentials flag:** Set `allow_credentials=True` for JWT in headers
- ✅ **Allowed methods:** POST, GET, OPTIONS only (no DELETE from browser)
- ⚠️ **Environment-specific:** Different CORS origins for dev/staging/prod

**Testing Requirements:**
- Integration test: Verify frontend can call auth endpoints
- Security test: Verify unauthorized origin blocked

**Residual Risk:** Low  
**Owner:** Dev Team  
**Timeline:** Task 4 (Auth API Routes)

---

## Low Risks (Monitoring Required)

### 16. PERF-002: Database Connection Pool Exhaustion During Load

**Score: 3 (Low)**  
**Category:** Performance  
**Probability:** Low (1) - Pool configured with 10 connections, max 20  
**Impact:** High (3) - All auth requests fail if pool exhausted

**Mitigation:**
- ✅ **Existing pool configuration:** `pool_size=10`, `max_overflow=20` (Story 1.2)
- ✅ **Async sessions:** FastAPI async reduces connection hold time
- ⚠️ **Pool monitoring:** Track connection usage in production
- ✅ **Connection lifecycle:** Proper session cleanup with `async with`

**Testing:** Load test with 30 concurrent requests  
**Residual Risk:** Very Low  
**Owner:** Dev Team  
**Timeline:** Task 11 (Integration Tests)

---

### 17. OPS-002: JWT Secret Rotation Not Supported

**Score: 2 (Low)**  
**Category:** Operational  
**Probability:** Low (1) - Secrets rarely need rotation in MVP  
**Impact:** Medium (2) - Rotating secret invalidates all tokens

**Mitigation:**
- ⚠️ **Not in MVP scope:** Manual secret rotation acceptable
- ⚠️ **Document process:** If secret rotates, all users must re-login
- ⚠️ **Future enhancement:** Support multiple signing keys for gradual rotation

**Testing:** None  
**Residual Risk:** Low  
**Owner:** Product Owner  
**Timeline:** Post-MVP

---

### 18. DATA-003: PII Logging in Auth Endpoints

**Score: 2 (Low)**  
**Category:** Data Security / Compliance  
**Probability:** Low (1) - Dev notes explicitly warn against logging PII  
**Impact:** Medium (2) - Privacy violations, GDPR non-compliance

**Mitigation:**
- ✅ **Documented standard:** "Never log sensitive data (passwords, tokens)"
- ✅ **Code review checklist:** Verify no PII in logs
- ✅ **Log sanitization:** Only log email (non-sensitive) and status codes
- ⚠️ **Future:** Implement log scrubbing for accidental PII leaks

**Testing:** Code review for `logger.debug()` statements  
**Residual Risk:** Very Low  
**Owner:** Dev Team  
**Timeline:** Throughout Story 1.3

---

## Risk Distribution

### By Category
- **Security (SEC):** 7 risks (3 critical, 2 high, 2 medium) - **Primary concern**
- **Technical (TECH):** 3 risks (1 high, 2 medium) - Repository pattern complexity
- **Data (DATA):** 3 risks (1 high, 2 low) - Secret management, PII handling
- **Performance (PERF):** 2 risks (2 medium) - Bcrypt hashing, connection pooling
- **Business (BUS):** 1 risk (1 medium) - Missing password reset
- **Operational (OPS):** 2 risks (2 medium) - Monitoring gaps

### By Component
- **Backend Auth Service:** 8 risks (SEC-001, SEC-002, SEC-004, SEC-006, DATA-001, DATA-002, TECH-002, PERF-001)
- **Frontend Auth UI:** 4 risks (SEC-003, SEC-004, TECH-003, SEC-007)
- **Repository Layer:** 2 risks (TECH-001, SEC-006)
- **Infrastructure:** 2 risks (PERF-002, OPS-001)
- **Operational:** 2 risks (OPS-002, DATA-003)

### By Probability
- **High (3):** 7 risks - Require proactive mitigation
- **Medium (2):** 7 risks - Monitor during development
- **Low (1):** 4 risks - Accept with documented residual risk

### By Impact
- **High (3):** 9 risks - Could compromise security or data integrity
- **Medium (2):** 8 risks - Degraded experience or operational issues
- **Low (1):** 1 risk - Minor inconvenience

---

## Risk-Based Testing Strategy

### Priority 1: Critical Risk Tests (Must Pass)

**Security Testing:**
1. **JWT Secret Validation** (SEC-001)
   - Test: Attempt to start app with weak secret (<32 chars) → Should fail with clear error
   - Test: Attempt to start app without JWT_SECRET env var → Should fail
   - Test: Verify production secret meets complexity requirements

2. **Password Hashing Security** (SEC-002)
   - Test: Register two users with same password → Verify different hashes
   - Test: Login with correct password → Success
   - Test: Login with incorrect password → 401 Unauthorized
   - Test: Measure bcrypt hash time → Should be ~200-300ms (cost factor 12)
   - Security test: Attempt timing attack on password verification

3. **XSS Prevention** (SEC-003)
   - Test: Register with `<script>alert('XSS')</script>` as full_name → Sanitized or rejected
   - Test: Register with `<img src=x onerror=alert('XSS')>` as email → Validation fails
   - Test: Verify CSP headers present in HTTP responses
   - Security test: OWASP ZAP scan of auth endpoints

**Test Data Requirements:**
- Valid test credentials: `test@example.com` / `SecurePass123!`
- XSS payloads: Script tags, img tags, event handlers
- Weak JWT secrets: `"secret"`, `"12345"`, `"short"`

---

### Priority 2: High Risk Tests (Recommended)

**Authentication Flow:**
4. **JWT Token Lifecycle** (SEC-004, TECH-002)
   - Test: Login → Verify token stored in localStorage
   - Test: Token expiration after 24 hours → Auto-logout
   - Test: Invalid token → 401 redirect to login
   - Test: Logout → Token removed from localStorage and Zustand store

5. **Rate Limiting Awareness** (SEC-005)
   - Test: 100 consecutive login attempts → Document current behavior (no limit)
   - Load test: Measure server response under 50 concurrent logins
   - Note: Actual rate limiting deferred to Epic 2

6. **Repository Pattern** (TECH-001)
   - Unit test: BaseRepository.get_by_id() with mocked AsyncSession
   - Unit test: BaseRepository.create() with flush and refresh
   - Integration test: CandidateRepository.get_by_email() with real DB
   - Type checking: Run mypy on repository code

**Test Data Requirements:**
- Multiple test candidates for concurrent operations
- Expired JWT tokens (mock time.now())
- Invalid JWT tokens (tampered signatures)

---

### Priority 3: Medium Risk Tests (Standard Coverage)

**Data Integrity:**
7. **Concurrent Registration** (DATA-002)
   - Test: Two simultaneous registrations with same email → One succeeds, one gets 400
   - Test: Verify database unique constraint enforced

8. **Frontend State Management** (TECH-003)
   - Test: Login in tab A, logout in tab B → Tab A redirects
   - Test: Token expiration → Frontend detects and redirects
   - Test: Refresh page while logged in → Auth state persists

9. **Error Handling** (DATA-001, DATA-003)
   - Test: Trigger authentication error → Verify JWT_SECRET not in logs
   - Test: Failed login → Verify only email and status code logged (no password)
   - Test: Invalid credentials → 401 with generic error message

**Standard Functional Tests:**
10. **Registration Flow**
    - Test: Valid registration → 201 Created with JWT token
    - Test: Duplicate email → 400 Bad Request
    - Test: Invalid email format → 422 Unprocessable Entity
    - Test: Password too short (<8 chars) → 422 Unprocessable Entity

11. **Login Flow**
    - Test: Valid credentials → 200 OK with JWT token
    - Test: Invalid password → 401 Unauthorized
    - Test: Non-existent email → 401 Unauthorized
    - Test: Missing fields → 422 Unprocessable Entity

12. **Interview Start Endpoint** (Protected Route)
    - Test: Valid token → 201 Created with Interview record
    - Test: No token → 401 Unauthorized
    - Test: Expired token → 401 Unauthorized
    - Test: Interview record created with candidate_id from token

---

### Priority 4: Low Risk Tests (Regression Suite)

**Performance Baseline:**
- Load test: 10 concurrent registrations (baseline for future comparison)
- Load test: 30 concurrent logins (verify connection pool sufficient)
- Performance test: Measure bcrypt hashing time (should be <500ms)

**Edge Cases:**
- Very long full_name (250+ characters) → Truncated or rejected
- Special characters in email → Properly encoded
- Empty request bodies → 422 Unprocessable Entity

---

## Risk Acceptance Criteria

### Must Fix Before Production (Blockers)

1. **SEC-001:** JWT secret strength validation implemented and verified
2. **SEC-002:** Password hashing with bcrypt (cost 12) tested and working
3. **SEC-003:** XSS prevention verified (CSP headers + input validation)
4. **TECH-001:** BaseRepository pattern implemented and unit tested

**Gate Decision:** If any critical risk unmitigated → **FAIL**

---

### Can Deploy with Mitigation (Accepted Risks)

1. **SEC-004:** LocalStorage token storage (architectural decision, mitigated by CSP)
2. **SEC-005:** No rate limiting in MVP (documented for Epic 2)
3. **DATA-001:** JWT secret logging risk (mitigated by code review)
4. **BUS-001:** No password reset (documented limitation)

**Gate Decision:** If high risks documented and mitigated → **CONCERNS** (deployable with caveats)

---

### Accepted Risks (Documented)

1. **OPS-001:** No authentication monitoring in MVP (manual log review only)
2. **OPS-002:** No JWT secret rotation support (manual process documented)
3. **PERF-001:** Bcrypt performance impact (acceptable for MVP scale)
4. **DATA-003:** PII logging risk (low probability with documented standards)

**Gate Decision:** If only low/medium risks → **PASS**

---

## Monitoring Requirements

### Post-Deployment Monitoring

**Security Metrics:**
- Failed login attempts per minute (alert if >10/min)
- Invalid token errors per hour (alert if >100/hr)
- 401 Unauthorized responses (track baseline)
- Registration rate (detect spam attacks)

**Performance Metrics:**
- Login response time p95 (<500ms expected)
- Registration response time p95 (<600ms expected, includes bcrypt)
- Authentication endpoint error rate (<1% target)
- Database connection pool utilization (<50% normal)

**Business Metrics:**
- Total registered candidates
- Daily active users (successful logins)
- Login success rate (target >95%)

**Alerting Rules:**
- Critical: Failed logins >50/min from single IP (potential brute force)
- Warning: Login response time >1s p95 (performance degradation)
- Info: New candidate registrations (track growth)

---

## Risk Review Triggers

Review and update this risk profile when:

1. **Architecture Changes:**
   - Switch from localStorage to httpOnly cookies (SEC-004)
   - Add rate limiting middleware (SEC-005)
   - Change password hashing algorithm (SEC-002)

2. **New Integrations:**
   - OAuth providers added (Google, LinkedIn)
   - Multi-factor authentication (MFA) implemented
   - Session management changes

3. **Security Incidents:**
   - Brute force attack detected
   - Token compromise reported
   - Vulnerability discovered in dependencies (PyJWT, passlib)

4. **Performance Issues:**
   - Login response time degrades >1s
   - Database connection pool exhaustion
   - Bcrypt CPU utilization impacts other services

5. **Regulatory Requirements:**
   - GDPR compliance audit
   - SOC 2 certification
   - Industry-specific regulations (HIPAA, PCI)

---

## Recommendations Summary

### Immediate Actions (Before Story 1.3 Completion)

1. ✅ **Implement JWT secret validation** (SEC-001) - Add Pydantic validator for 32+ char requirement
2. ✅ **Comprehensive password hashing tests** (SEC-002) - Verify bcrypt cost factor 12, salt uniqueness
3. ✅ **XSS security testing** (SEC-003) - OWASP ZAP scan, manual payload injection
4. ✅ **BaseRepository unit tests** (TECH-001) - Mock AsyncSession, test all CRUD operations
5. ✅ **Secret logging audit** (DATA-001) - Code review for accidental JWT_SECRET exposure

### Near-Term Improvements (Epic 2)

1. ⚠️ **Rate limiting implementation** (SEC-005) - SlowAPI middleware for auth endpoints
2. ⚠️ **Authentication monitoring** (OPS-001) - Sentry integration, failed login alerts
3. ⚠️ **Password reset flow** (BUS-001) - Email-based password reset
4. ⚠️ **Multi-tab session sync** (TECH-003) - Storage event listeners for auth state

### Future Enhancements (Post-MVP)

1. ⚠️ **HttpOnly cookie storage** (SEC-004) - Replace localStorage for enhanced security
2. ⚠️ **JWT secret rotation** (OPS-002) - Support multiple signing keys
3. ⚠️ **Token refresh mechanism** (TECH-002) - Short-lived access tokens with refresh tokens
4. ⚠️ **Password complexity enforcement** (SEC-002) - Strengthen from 8 to 10+ characters

---

## Appendix: Risk Scoring Calculation

**Overall Risk Score:** 43/100

**Calculation:**
```
Base Score: 100 points
- Critical risks (3 × 20 points): -60
- High risks (4 × 10 points): -40
- Medium risks (7 × 5 points): -35
- Low risks (4 × 2 points): -8
───────────────────────────────
Minimum score: 0 (max 143 deductions)
Actual deductions: 143
Capped at: 100 base points
───────────────────────────────
Final Score: 100 - 57 = 43/100
```

*Note: Deductions exceed 100 points, indicating very high-risk story. Score capped at 43 to reflect realistic risk level after planned mitigations.*

**Risk Level Interpretation:**
- 80-100: Low Risk (Minimal concerns)
- 60-79: Medium Risk (Standard mitigation required)
- 40-59: High Risk (Significant attention needed) ← **Story 1.3**
- 0-39: Critical Risk (May require architectural changes)

**Justification:**  
Authentication stories inherently carry high risk due to security-critical nature. Score of 43 is **appropriate and expected** for foundational auth implementation. With planned mitigations (JWT validation, XSS prevention, password hashing tests), residual risk will be acceptable for MVP deployment.

---

## Sign-Off

**Prepared By:** Quinn (Test Architect)  
**Date:** 2025-10-29  
**Status:** Ready for Review

**Recommended Gate Decision:**
- If all critical risks (SEC-001, SEC-002, SEC-003) mitigated → **CONCERNS** (deployable)
- If any critical risk unmitigated → **FAIL** (block deployment)

**Next Steps:**
1. Dev team reviews critical risks (SEC-001, SEC-002, SEC-003)
2. Implement mitigation strategies during Story 1.3 development
3. Execute Priority 1 security tests before story completion
4. Update gate file with final risk assessment
5. Product Owner approves accepted risks (SEC-004, SEC-005)

---

*This risk profile will be referenced in quality gate decision (qa-gate task).*
