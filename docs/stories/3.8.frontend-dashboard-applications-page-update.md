# Story 3.8: Frontend Dashboard and Applications Page Update

## Status
Draft

## Story Context

**Existing System Integration:**
- Depends on: Story 3.5 (Application REST API Endpoints - COMPLETED ✅), Story 3.7 (Frontend Job Browsing Page Update - COMPLETED ✅)
- Integrates with: Existing `/dashboard/page.tsx` and `/applications/page.tsx` with mock data, Next.js App Router, shadcn/ui components
- Technology: Next.js 14, TypeScript, React 18, TanStack Query (React Query), shadcn/ui, Tailwind CSS, Zustand (auth store)
- Follows pattern: Existing frontend architecture (App Router, TypeScript, shadcn/ui components), API integration pattern from Story 3.7
- Touch points: Dashboard stats cards, Recent Applications section, Applications page full replacement

## Story

**As an** authenticated candidate,  
**I want** to see my real application history and status on the dashboard and applications page,  
**so that** I can track my job search progress.

## Acceptance Criteria

**Functional Requirements:**

1. `/dashboard/page.tsx` "Recent Applications" section updated to fetch from `GET /api/v1/applications/me` API endpoint
2. `/applications/page.tsx` completely updated to fetch from `GET /api/v1/applications/me` API endpoint
3. Custom hook `useApplications` created for data fetching with loading/error/success states
4. Skeleton loaders implemented for initial load on both dashboard and applications pages
5. Application status badges use existing color scheme and styling
6. "View Interview Results" link displayed when `interview_id` exists and `interview.status === 'completed'` (nested interview object)
7. Link navigates to `/interview/results/{interview_id}` page (existing route)
8. Empty state displayed on applications page when candidate has no applications
9. Error handling displays user-friendly messages with retry button
10. Dashboard stats dynamically calculated from real application data (total applications, active interviews, etc.)

**UI/UX Requirements:**

11. Existing UI/UX preserved: card layouts, badges, icons, spacing, colors all remain unchanged
12. Loading state shows skeleton cards (same dimensions as real cards) to prevent layout shift
13. Application cards display: job title, company, status badge, applied date, next step message
14. Tab filtering on applications page works with real data (All, Interviews, Under Review, Applied)
15. Status badge colors match existing design system

**Quality Requirements:**

16. Code follows Next.js 14 App Router patterns (use client components appropriately)
17. TypeScript strict mode compliance (no `any` types, proper type definitions)
18. Authentication required: pages redirect to `/login` if user not authenticated
19. React Query caching prevents unnecessary refetches
20. Component follows existing pattern from Story 3.7 (`/jobs/page.tsx`) for API integration

## Tasks / Subtasks

- [x] **Task 0: Verify Application API Endpoints Available** (AC: 1, 2, 18)
  - [x] Verify Story 3.5 completed: `GET /api/v1/applications/me` endpoint exists
  - [x] Verify Story 3.5 completed: `GET /api/v1/applications/{id}` endpoint exists
  - [x] Test endpoints manually with authenticated request (JWT token)
  - [x] Verify response schema matches TypeScript interfaces needed
  - [x] Confirm authentication middleware working (401 on missing/invalid token)
  - [x] Source: [backend/app/api/v1/applications.py (from Story 3.5)]

- [x] **Task 1: Create Application API Types and Interfaces** (AC: 3, 17)
  - [x] Create or update `frontend/lib/api-client.ts` with application API functions
  - [x] Define TypeScript interfaces matching backend schemas:
    - `Application` interface (id, job_posting_id, candidate_id, status, applied_at, interview_id, created_at, updated_at)
    - `ApplicationWithJobDetails` interface (extends Application, adds job_posting: JobPosting, interview?: InterviewBasic)
    - `ApplicationStatus` type union ('applied' | 'interview_scheduled' | 'interview_completed' | 'under_review' | 'rejected' | 'offered' | 'accepted' | 'withdrawn')
    - `InterviewBasic` interface (id, status, role_type) for nested interview data
  - [x] **IMPORTANT:** Backend returns `ApplicationWithJobDetails[]` directly (array), NOT an object with pagination metadata
  - [x] Create function `getMyApplications(): Promise<ApplicationWithJobDetails[]>`
  - [x] Create function `getApplicationById(id: string): Promise<ApplicationWithJobDetails>`
  - [x] Use existing `API_BASE_URL` from environment variable
  - [x] Include JWT token from localStorage in Authorization header
  - [x] Source: [frontend/lib/api-client.ts (from Story 3.7), backend/app/schemas/application.py, backend/app/api/v1/applications.py]

- [x] **Task 2: Create useApplications Custom Hook** (AC: 3, 4, 19)
  - [x] Create file `frontend/hooks/use-applications.ts`
  - [x] Import React Query hooks: `import { useQuery } from '@tanstack/react-query'`
  - [x] Import API client: `import { getMyApplications } from '@/lib/api-client'`
  - [x] Define query key: `['applications', 'me']`
  - [x] Create hook `useApplications()` that calls `useQuery`
  - [x] Configure React Query options: staleTime=5min, refetchOnMount=true
  - [x] Return type: `UseQueryResult<ApplicationWithJobDetails[], Error>` (data is array, not object)
  - [x] Return includes: `{ data, isLoading, isError, error, refetch }` where data is `ApplicationWithJobDetails[]` or undefined
  - [x] Add JSDoc comment explaining hook usage and that data is an array
  - [x] Source: [frontend/hooks/use-job-postings.ts (from Story 3.7 pattern)]

- [x] **Task 3: Update Dashboard Page - Recent Applications Section** (AC: 1, 4, 10, 11, 12, 16, 18)
  - [x] Open `frontend/app/dashboard/page.tsx`
  - [x] Verify `"use client"` directive exists at top
  - [x] Import `useApplications` hook: `import { useApplications } from '@/hooks/use-applications'`
  - [x] Import `useAuthStore` for authentication check: `import { useAuthStore } from '@/src/features/auth/store/authStore'`
  - [x] Import Skeleton component: `import { Skeleton } from "@/components/ui/skeleton"`
  - [x] Replace mock `recentApplications` data with `useApplications()` hook call
  - [x] **IMPORTANT:** data is an array `ApplicationWithJobDetails[]`, not an object
  - [x] Extract top 3 applications: `const recentApps = data?.slice(0, 3) || []`
  - [x] Update stats calculation: use real data counts instead of mock stats
    - stats.applications = data?.length || 0
    - stats.interviews = data?.filter(a => a.status === 'interview_scheduled').length || 0
    - Keep stats.matches and stats.profileCompletion as static for now (future enhancement)
  - [x] Implement loading state: show 3 skeleton cards in Recent Applications section
  - [x] Implement error state: show error message with retry button
  - [x] Implement empty state: show "No applications yet" message with "Browse Jobs" link
  - [x] Update application card mapping: iterate `recentApps.map()` (already sliced to 3 items)
  - [x] Preserve existing card layout and styling
  - [x] Source: [frontend/app/dashboard/page.tsx (existing file), Story 3.7 pattern]

- [x] **Task 4: Update Applications Page - Full Replacement** (AC: 2, 4, 5, 6, 7, 8, 9, 11, 12, 13, 14, 15, 16, 18)
  - [x] Open `frontend/app/applications/page.tsx`
  - [x] Verify `"use client"` directive exists at top
  - [x] Import `useApplications` hook: `import { useApplications } from '@/hooks/use-applications'`
  - [x] Import `useAuthStore` for authentication check
  - [x] Import Skeleton component: `import { Skeleton } from "@/components/ui/skeleton"`
  - [x] Import `useRouter` for navigation: `import { useRouter } from 'next/navigation'`
  - [x] Replace mock `applications` data with `useApplications()` hook call
  - [x] **IMPORTANT:** data is an array `ApplicationWithJobDetails[]`, not an object
  - [x] Implement loading state: show skeleton cards (4-6 cards matching real card dimensions)
  - [x] Implement error state: show error message card with retry button
  - [x] Implement empty state: show centered card with message "No applications yet" and "Browse Jobs" button
  - [x] Update stats calculation from real data (data is array):
    - stats.total = data?.length || 0
    - stats.active = data?.filter(a => !['rejected', 'withdrawn'].includes(a.status)).length || 0
    - stats.interviews = data?.filter(a => a.status === 'interview_scheduled').length || 0
    - stats.pending = data?.filter(a => a.status === 'under_review').length || 0
  - [x] Update tab counts dynamically from filtered data
  - [x] Update application card mapping: use `data` array directly instead of mock
  - [x] Add "View Interview Results" button/link when `app.interview_id && app.interview?.status === 'completed'`
  - [x] Implement navigation: `router.push(\`/interview/results/\${app.interview_id}\`)`
  - [x] Preserve existing UI: card layout, status badges, icons, colors
  - [x] Source: [frontend/app/applications/page.tsx (existing file), Story 3.7 pattern]

- [x] **Task 5: Add Helper Functions for Application Display** (AC: 13, 15)
  - [x] Add helper function `formatAppliedDate(appliedAt: string): string` to format date as relative time ("2 days ago", "1 week ago")
  - [x] Add helper function `getStatusConfig(status: ApplicationStatus)` to return badge color, label, and icon
  - [x] Use existing status badge color scheme from current implementation
  - [x] Ensure status labels user-friendly: "Interview Scheduled", "Under Review", "Applied", "Not Selected", etc.
  - [x] Source: [frontend/app/jobs/page.tsx (Story 3.7) for date formatting pattern]

- [x] **Task 6: Handle Authentication and Authorization** (AC: 18)
  - [x] Verify both pages check authentication status using `useAuthStore`
  - [x] Implement redirect to `/login` if user not authenticated (use `useEffect` + `useRouter`)
  - [x] Add loading state to prevent flash of content before redirect: `if (!isAuthenticated) return <div>Redirecting...</div>;`
  - [x] Ensure API calls include JWT token in Authorization header (already handled by api-client.ts)
  - [x] Handle 401 responses gracefully: clear auth store and redirect to login
  - [x] Source: [frontend/src/features/auth/store/authStore.ts, frontend/lib/api-client.ts]

- [x] **Task 7: Environment Variables and Configuration** (AC: 1, 2)
  - [x] Verify `frontend/.env.local` exists with: `NEXT_PUBLIC_API_URL=http://localhost:8000/api/v1`
  - [x] If missing, create from template: `cp frontend/.env.example frontend/.env.local`
  - [x] Verify `frontend/.env.example` documents the variable with default value
  - [x] No new environment variables needed (reuse existing from Story 3.7)
  - [x] Source: [frontend/.env.local, frontend/.env.example]

- [x] **Task 8: Type Safety and Linting** (AC: 17)
  - [x] Run TypeScript compiler: `cd frontend && pnpm tsc --noEmit`
  - [x] Fix any type errors in new code
  - [x] Run linter: `cd frontend && pnpm lint`
  - [x] Fix any linting warnings
  - [x] Ensure no `any` types used (prefer `unknown` if type truly unknown)
  - [x] Verify all TypeScript interfaces properly defined
  - [x] Source: [docs/architecture/frontend/11-frontend-developer-standards.md]

- [ ] **Task 9: Manual Testing** (AC: 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 18)
  - [ ] Start backend server: `cd backend && uvicorn main:app --reload`
  - [ ] Ensure application seed data exists: Create test applications via API or UI
  - [ ] Start frontend dev server: `cd frontend && pnpm dev`
  - [ ] **Test authentication:**
    - [ ] Navigate to http://localhost:3000/dashboard without auth → verify redirect to /login
    - [ ] Login with valid credentials → verify redirect back to /dashboard
    - [ ] Verify JWT token stored in localStorage
  - [ ] **Test dashboard page:**
    - [ ] Navigate to /dashboard (authenticated)
    - [ ] Verify skeleton loaders appear briefly during loading
    - [ ] Verify Recent Applications section displays top 3 applications from API
    - [ ] Verify stats cards show correct counts (total apps, interviews scheduled)
    - [ ] Verify application cards show: job title, company, status badge, applied date
    - [ ] Test with 0 applications: verify empty state message "No applications yet"
  - [ ] **Test applications page:**
    - [ ] Navigate to /applications (authenticated)
    - [ ] Verify skeleton loaders appear during initial load
    - [ ] Verify all applications displayed after load
    - [ ] Verify stats cards accurate (Total, Active, Interviews, Under Review)
    - [ ] Test tab filtering: click "Interviews" tab → verify only interview_scheduled apps shown
    - [ ] Test tab filtering: click "Under Review" tab → verify only under_review apps shown
    - [ ] Test tab counts: verify numbers in tabs match filtered data
    - [ ] Test with 0 applications: verify empty state with "Browse Jobs" button
  - [ ] **Test interview results link:**
    - [ ] Create application with linked interview (interview_id set, status=completed)
    - [ ] Verify "View Interview Results" link/button appears on application card
    - [ ] Click link → verify navigation to `/interview/results/{interview_id}`
    - [ ] Verify interview results page loads correctly (existing page from previous stories)
  - [ ] **Test error handling:**
    - [ ] Stop backend server
    - [ ] Reload /applications page
    - [ ] Verify error message displays with retry button
    - [ ] Click "Retry" button → verify refetch attempted
    - [ ] Restart backend server → retry should succeed
  - [ ] **Test visual consistency:**
    - [ ] Compare new API-driven UI with old mock data UI
    - [ ] Verify card layouts identical (spacing, borders, shadows)
    - [ ] Verify badge colors match existing design
    - [ ] Verify icons and typography consistent
  - [ ] **Test responsive design:**
    - [ ] Resize browser to 375px width (mobile)
    - [ ] Verify layout stacks correctly on mobile
    - [ ] Verify cards remain readable and accessible
    - [ ] Resize to desktop → verify layout expands correctly

## Dev Notes

### Previous Story Insights

**From Story 3.5: Application REST API Endpoints (COMPLETED ✅)**

- **API Endpoints Created:**
  - `POST /api/v1/applications` - Create application (authenticated)
  - `GET /api/v1/applications/me` - Get candidate's applications (authenticated)
  - `GET /api/v1/applications/{id}` - Get single application detail (authenticated)
- **Response Schemas:**
  - `ApplicationResponse`: { id, job_posting_id, candidate_id, status, applied_at, interview_id, created_at, updated_at }
  - `ApplicationWithJobDetails`: Includes nested job_posting object with full job details and optional interview object
  - **IMPORTANT:** `GET /api/v1/applications/me` returns `list[ApplicationResponse]` (array), NOT an object with pagination metadata
- **Authentication Required:** All endpoints require JWT token in Authorization header
- **Status Enum Values:** applied, interview_scheduled, interview_completed, under_review, rejected, offered, accepted, withdrawn
- **Interview Linking:** `interview_id` field present when interview created, null otherwise
- **Interview Status:** Nested `interview` object contains `{ id, status, role_type }` when interview exists

**From Story 3.7: Frontend Job Browsing Page Update (COMPLETED ✅)**

- **API Integration Pattern Established:**
  - Custom hooks wrapping React Query (useQuery pattern)
  - API client with fetch wrapper in `frontend/lib/api-client.ts`
  - Type-safe interfaces matching backend schemas
  - Loading/error/success states handled via React Query
  - Skeleton loaders for initial page load
  - Empty state and error state components
- **File Structure:**
  - API client: `frontend/lib/api-client.ts`
  - Custom hooks: `frontend/hooks/use-*.ts`
  - Pages: `frontend/app/*/page.tsx`
- **Helper Functions Pattern:**
  - Date formatting: `formatPostedDate()` converts ISO to relative time
  - Salary formatting: `formatSalaryRange()` handles null values gracefully
- **React Query Configuration:**
  - Query keys: `['resource', 'operation', filters]` pattern
  - staleTime: 5 minutes
  - refetchOnWindowFocus: false (already configured in queryClient)

**From Story 1.3: Authentication & Candidate Session Management (COMPLETED ✅)**

- **Authentication Pattern:**
  - Zustand auth store: `frontend/src/features/auth/store/authStore.ts`
  - Store shape: `{ user: User | null, token: string | null, setAuth, clearAuth, isAuthenticated }`
  - Token stored in both localStorage ('auth_token') and Zustand state
  - JWT token included in API requests via Authorization header
- **Protected Routes:**
  - Check authentication with `useAuthStore((state) => state.isAuthenticated())`
  - Redirect to `/login` if not authenticated
  - Use `useRouter` from `next/navigation` for programmatic navigation

### Technical Architecture Context

**Frontend Tech Stack** [Source: docs/architecture/frontend/02-frontend-tech-stack.md]
- **Framework:** Next.js 14 (App Router, React 18, TypeScript 5)
- **State Management:** 
  - React Query (TanStack Query) for server state
  - Zustand for global client state (auth)
  - React hooks for local component state
- **UI Components:** shadcn/ui (Radix UI primitives + Tailwind CSS)
- **Styling:** Tailwind CSS utility classes
- **HTTP Client:** Native `fetch` API wrapped in api-client.ts

**API Integration Pattern** [Source: docs/architecture/frontend/06-api-integration.md, Story 3.7]
- **Pattern:** React Query for data fetching, custom hooks wrapping useQuery/useMutation
- **Query Keys:** Factory pattern for cache invalidation (`['applications', 'me']`)
- **Caching Strategy:** staleTime=5min, gcTime=30min, retry=2
- **Error Handling:** React Query error states, user-friendly error messages
- **Loading States:** React Query isLoading, skeleton loaders prevent layout shift
- **Auth Token:** Included automatically in apiClient from localStorage

**Authentication Integration** [Source: docs/architecture/coding-standards.md, Story 1.3]
- **Auth Store (Zustand):**
  - Location: `frontend/src/features/auth/store/authStore.ts`
  - State: `{ user: User | null, token: string | null }`
  - Actions: `setAuth(user, token)`, `clearAuth()`, `isAuthenticated()`
  - Persistence: Uses Zustand persist middleware, syncs with localStorage
- **Token Management:**
  - JWT stored in localStorage key: 'auth_token'
  - Included in API requests: `Authorization: Bearer {token}`
  - 401 responses: Trigger clearAuth() and redirect to /login
- **Protected Pages Pattern:**
  ```typescript
  const isAuthenticated = useAuthStore((state) => state.isAuthenticated());
  useEffect(() => {
    if (!isAuthenticated) {
      router.push('/login');
    }
  }, [isAuthenticated, router]);
  ```

**Component Standards** [Source: docs/architecture/frontend/04-component-standards.md]
- **File Naming:** page.tsx for routes (Next.js convention)
- **Client Components:** Require `"use client"` directive when using hooks/state
- **Props:** Explicit TypeScript interfaces, no implicit any
- **Exports:** Default export for pages, named exports for components

**Styling Guidelines** [Source: docs/architecture/frontend/08-styling-guidelines.md]
- **Utility-First:** Tailwind CSS classes directly in JSX
- **Component Variants:** Use `cn()` utility to merge class names
- **Responsive:** Mobile-first breakpoints (sm:, md:, lg:, xl:)
- **Spacing:** Consistent spacing using Tailwind scale (space-y-4, gap-2, p-6)
- **Status Badge Colors (from existing code):**
  - interview_scheduled: `bg-accent/10 text-accent border-accent/20`
  - under_review: `bg-primary/10 text-primary border-primary/20`
  - applied: `bg-muted text-muted-foreground`
  - rejected: `bg-destructive/10 text-destructive border-destructive/20`

### File Locations and Structure

[Source: docs/architecture/frontend/03-project-structure.md, Story 3.7]

**Files to Create:**
- `frontend/hooks/use-applications.ts` - Custom React Query hook for applications

**Files to Update:**
- `frontend/lib/api-client.ts` - Add application API functions and types
- `frontend/app/dashboard/page.tsx` - Replace Recent Applications mock data with API
- `frontend/app/applications/page.tsx` - Complete replacement with API integration

**Files Already Exist (No Changes):**
- `frontend/app/providers.tsx` - React Query provider (from Story 3.7)
- `frontend/src/services/api/queryClient.ts` - Query client config (legacy location)
- `frontend/components/ui/skeleton.tsx` - Skeleton component (from Story 3.7)
- `frontend/.env.local` - Environment variables (from Story 3.7)
- `frontend/src/features/auth/store/authStore.ts` - Auth store (from Story 1.3)

**Files Referenced (Read-Only):**
- `frontend/components/ui/card.tsx` - Existing Card component
- `frontend/components/ui/button.tsx` - Existing Button component
- `frontend/components/ui/badge.tsx` - Existing Badge component
- `frontend/components/ui/tabs.tsx` - Existing Tabs component
- `frontend/lib/utils.ts` - Existing cn() utility function

### TypeScript Type Definitions

**Application Interface** (matches backend ApplicationResponse schema):
```typescript
export interface Application {
  id: string; // UUID as string
  job_posting_id: string; // UUID as string
  candidate_id: string; // UUID as string
  status: ApplicationStatus;
  applied_at: string; // ISO 8601 datetime string
  interview_id: string | null; // UUID as string or null
  created_at: string; // ISO 8601 datetime string
  updated_at: string; // ISO 8601 datetime string
}

export type ApplicationStatus = 
  | 'applied'
  | 'interview_scheduled'
  | 'interview_completed'
  | 'under_review'
  | 'rejected'
  | 'offered'
  | 'accepted'
  | 'withdrawn';

export interface InterviewBasic {
  id: string; // UUID as string
  status: string; // 'in_progress', 'completed', etc.
  role_type: string; // 'react', 'python', 'javascript', 'fullstack'
}

export interface ApplicationWithJobDetails extends Application {
  job_posting: JobPosting; // Nested job posting object (from Story 3.7)
  interview?: InterviewBasic; // Optional nested interview object (present when interview_id is not null)
}

// IMPORTANT: Backend returns ApplicationWithJobDetails[] directly (array)
// No wrapper object with 'total' field - calculate total from array.length
```

**Helper Function Type Definitions:**
```typescript
interface StatusConfig {
  label: string;
  color: string;
  icon: React.ComponentType<{ className?: string }>;
}

function getStatusConfig(status: ApplicationStatus): StatusConfig;
function formatAppliedDate(appliedAt: string): string;
```

### Mapping Mock Data to Real API Data

**Dashboard Page Mock Data → API Data Mapping:**
- `recentApplications[]` → `data?.slice(0, 3) || []` (data is array, take first 3)
- `stats.applications` → `data?.length || 0`
- `stats.interviews` → `data?.filter(a => a.status === 'interview_scheduled').length || 0`
- `app.jobTitle` → `app.job_posting.title`
- `app.company` → `app.job_posting.company`
- `app.status` → `app.status` (already matches)
- `app.appliedAt` → `formatAppliedDate(app.applied_at)`
- `app.nextStep` → Computed based on status (see helper functions)

**Applications Page Mock Data → API Data Mapping:**
- `applications[]` → `data` (data is already array of ApplicationWithJobDetails)
- `stats.total` → `data?.length || 0`
- `stats.active` → `data?.filter(a => !['rejected', 'withdrawn'].includes(a.status)).length || 0`
- `stats.interviews` → `data?.filter(a => a.status === 'interview_scheduled').length || 0`
- `stats.pending` → `data?.filter(a => a.status === 'under_review').length || 0`
- `app.location` → `app.job_posting.location`
- `app.salary` → `formatSalaryRange(app.job_posting.salary_range_min, app.job_posting.salary_range_max)` (from Story 3.7)

**Status Badge Mapping (preserve existing colors):**
```typescript
function getStatusConfig(status: ApplicationStatus): StatusConfig {
  switch (status) {
    case 'interview_scheduled':
      return {
        label: 'Interview Scheduled',
        color: 'bg-accent/10 text-accent border-accent/20',
        icon: Calendar,
      };
    case 'under_review':
      return {
        label: 'Under Review',
        color: 'bg-primary/10 text-primary border-primary/20',
        icon: Clock,
      };
    case 'applied':
      return {
        label: 'Applied',
        color: 'bg-muted text-muted-foreground',
        icon: CheckCircle2,
      };
    case 'interview_completed':
      return {
        label: 'Interview Complete',
        color: 'bg-green-500/10 text-green-700 border-green-500/20',
        icon: CheckCircle2,
      };
    case 'rejected':
      return {
        label: 'Not Selected',
        color: 'bg-destructive/10 text-destructive border-destructive/20',
        icon: XCircle,
      };
    case 'offered':
      return {
        label: 'Offer Received',
        color: 'bg-green-500/10 text-green-700 border-green-500/20',
        icon: CheckCircle2,
      };
    default:
      return {
        label: status,
        color: 'bg-muted text-muted-foreground',
        icon: AlertCircle,
      };
  }
}
```

**Date Formatting (reuse from Story 3.7):**
```typescript
function formatAppliedDate(appliedAt: string): string {
  const date = new Date(appliedAt);
  const now = new Date();
  const diffMs = now.getTime() - date.getTime();
  const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
  
  if (diffDays === 0) return 'Today';
  if (diffDays === 1) return 'Yesterday';
  if (diffDays < 7) return `${diffDays} days ago`;
  if (diffDays < 30) return `${Math.floor(diffDays / 7)} weeks ago`;
  return `${Math.floor(diffDays / 30)} months ago`;
}
```

**Tab Filtering Logic (Applications Page):**
```typescript
// Filter applications based on active tab
const filterByTab = (apps: ApplicationWithJobDetails[], tab: string) => {
  switch(tab) {
    case 'all': 
      return apps;
    case 'interviews': 
      return apps.filter(a => a.status === 'interview_scheduled');
    case 'under_review': 
      return apps.filter(a => a.status === 'under_review');
    case 'applied': 
      return apps.filter(a => a.status === 'applied');
    default: 
      return apps;
  }
};

// Calculate tab counts dynamically
const tabCounts = {
  all: data?.length || 0,
  interviews: data?.filter(a => a.status === 'interview_scheduled').length || 0,
  underReview: data?.filter(a => a.status === 'under_review').length || 0,
  applied: data?.filter(a => a.status === 'applied').length || 0,
};
```

**Skeleton Loader Pattern:**
```tsx
// Dashboard Recent Applications: 3 skeleton cards, height ~120px each
{isLoading && (
  <div className="space-y-4">
    {[1, 2, 3].map(i => (
      <Card key={i}>
        <CardContent className="p-6">
          <Skeleton className="h-6 w-3/4 mb-2" /> {/* Job title */}
          <Skeleton className="h-4 w-1/2 mb-4" /> {/* Company */}
          <Skeleton className="h-4 w-full" />     {/* Details */}
        </CardContent>
      </Card>
    ))}
  </div>
)}

// Applications Page: 4-6 skeleton cards matching real card dimensions
{isLoading && (
  <div className="grid gap-4 md:grid-cols-2">
    {[1, 2, 3, 4].map(i => (
      <Card key={i}>
        <CardHeader>
          <Skeleton className="h-6 w-3/4 mb-2" />
          <Skeleton className="h-4 w-1/2" />
        </CardHeader>
        <CardContent>
          <Skeleton className="h-4 w-full mb-2" />
          <Skeleton className="h-4 w-2/3" />
        </CardContent>
      </Card>
    ))}
  </div>
)}
```

### Testing Strategy

[Source: docs/architecture/frontend/09-testing-requirements.md, Story 3.7]

**Testing Standards for This Story:**

Manual testing approach is required (no automated tests for this story). The testing strategy focuses on:
- Framework: Manual browser-based testing
- Test execution: Local development environment (backend + frontend running)
- Coverage areas: Authentication flow, API integration, visual consistency, error handling, responsive design
- Test data: Create applications via API or UI before testing
- Validation: All acceptance criteria verified through manual test cases

**Manual Testing Focus:**
1. **Authentication Flow:** Verify redirect to login when unauthenticated, verify JWT token handling
2. **Data Integration:** Ensure applications displayed from API correctly on both pages
3. **Visual Consistency:** UI must look identical to mock data version
4. **Error Scenarios:** Network failures, empty results handled gracefully
5. **Interview Link:** "View Interview Results" link works when interview completed

### Known Edge Cases and Constraints

1. **No Applications on First Load:**
   - Dashboard and Applications pages will show empty state
   - Solution: Create test applications via `/jobs` page or seed script
   
2. **Interview Link Conditional Display:**
   - Only show "View Interview Results" when `interview_id` is NOT null AND `interview.status === 'completed'`
   - Field path is `app.interview?.status` (nested interview object), not `app.interview_status` at root level
   - Backend returns nested interview object: `{ id, status, role_type }` when interview_id exists
   
3. **Authentication Token Expiration:**
   - JWT tokens expire after 24 hours (from Story 1.3)
   - 401 responses should clear auth and redirect to login
   - Handled by api-client.ts error handling
   
4. **Stats Calculation:**
   - Dashboard stats "Matched Jobs" and "Profile Completion" remain static (future enhancement)
   - Only "Applications" and "Interviews" stats dynamic from API
   
5. **Tab Filtering Performance:**
   - Filter operations done in-memory (client-side) since all applications already fetched
   - For large application lists (>100), consider pagination or server-side filtering
   
6. **Interview Results Page Exists:**
   - Assumes `/interview/results/{interview_id}` page already exists from previous stories
   - Verify route exists before implementing navigation

### Integration Verification Checklist

**IV1: Authentication Integration** - Verify auth flow works correctly
- [ ] Unauthenticated users redirected to /login from /dashboard and /applications
- [ ] JWT token from localStorage included in API requests automatically
- [ ] 401 responses trigger clearAuth() and redirect to login
- [ ] Token persists across page reloads (Zustand persist middleware)

**IV2: API Response Schema Match** - Confirm API responses match TypeScript interfaces
- [ ] GET /api/v1/applications/me returns `ApplicationWithJobDetails[]` array (NOT an object with total field)
- [ ] ApplicationWithJobDetails includes nested job_posting object
- [ ] ApplicationWithJobDetails includes nested interview object when interview_id exists: `{ id, status, role_type }`
- [ ] All enum values match (status: 'applied' | 'interview_scheduled' | ...)
- [ ] Date fields are ISO 8601 strings, not Date objects

**IV3: Visual Consistency** - Verify API-driven UI matches mock data UI
- [ ] Card layouts identical (spacing, borders, shadows, padding)
- [ ] Badge colors and styles match existing design
- [ ] Icon sizes and positions match
- [ ] Typography (font sizes, weights, colors) matches

**IV4: Interview Results Navigation** - Confirm link to interview results works
- [ ] `/interview/results/{interview_id}` route exists (from previous stories)
- [ ] Navigation works correctly from applications page
- [ ] Interview results page loads successfully with interview data

## Testing

### Manual Testing Checklist

**Test Environment Setup:**
1. Ensure backend running: `cd backend && uvicorn main:app --reload`
2. Ensure seed data exists: Create test applications (apply to jobs via UI or API)
3. Start frontend dev server: `cd frontend && pnpm dev`
4. Ensure authenticated session: Login at http://localhost:3000/login

**Test Cases:**

**TC1: Authentication Flow**
- [ ] Navigate to http://localhost:3000/dashboard without authentication
- [ ] Verify redirect to /login
- [ ] Login with valid credentials (email: test@example.com, password from seed data)
- [ ] Verify redirect back to /dashboard after successful login
- [ ] Verify JWT token present in localStorage (key: 'auth_token')
- [ ] Verify user data present in Zustand auth store

**TC2: Dashboard Page - Initial Load**
- [ ] Navigate to /dashboard (authenticated)
- [ ] Verify skeleton loaders appear during initial load (Recent Applications section)
- [ ] Verify real applications appear after data loads (top 3 most recent)
- [ ] Verify stats cards show correct counts (total apps = array length, interviews scheduled)
- [ ] Verify no console errors

**TC3: Dashboard Page - Recent Applications Section**
- [ ] Verify each application card displays:
  - [ ] Job title from job_posting.title
  - [ ] Company from job_posting.company
  - [ ] Status badge with correct color and label
  - [ ] Applied date formatted as relative time ("2 days ago")
  - [ ] Next step message
- [ ] Verify maximum 3 applications shown
- [ ] Click "View Details" button → verify navigation to application detail

**TC4: Dashboard Page - Empty State**
- [ ] Delete or clear all applications for test user
- [ ] Reload /dashboard
- [ ] Verify empty state message: "No applications yet"
- [ ] Verify "Browse Jobs" link present and functional

**TC5: Applications Page - Initial Load**
- [ ] Navigate to /applications (authenticated)
- [ ] Verify skeleton loaders appear during initial load
- [ ] Verify all applications displayed after load
- [ ] Verify stats cards accurate:
  - [ ] Total Applications count
  - [ ] Active Applications count (excludes rejected/withdrawn)
  - [ ] Interviews count (status = interview_scheduled)
  - [ ] Under Review count (status = under_review)
- [ ] Verify no console errors

**TC6: Applications Page - Tab Filtering**
- [ ] Verify "All" tab shows all applications
- [ ] Click "Interviews" tab → verify only applications with status='interview_scheduled' shown
- [ ] Verify tab count updates: "Interviews (X)" matches filtered count
- [ ] Click "Under Review" tab → verify only status='under_review' applications shown
- [ ] Click "Applied" tab → verify only status='applied' applications shown
- [ ] Verify tab counts dynamic (update based on real data)

**TC7: Applications Page - Application Cards**
- [ ] Verify each application card displays:
  - [ ] Job title
  - [ ] Company name
  - [ ] Status badge with correct color
  - [ ] Applied date formatted
  - [ ] Location and salary (if available)
  - [ ] Next step message
- [ ] Verify "View Details" button present on each card
- [ ] Verify status badge colors match design system

**TC8: Applications Page - Interview Results Link**
- [ ] Create test application with interview_id set and interview.status='completed'
- [ ] Navigate to /applications
- [ ] Verify "View Interview Results" link/button displayed on that application card
- [ ] Click link → verify navigation to `/interview/results/{interview_id}`
- [ ] Verify interview results page loads correctly
- [ ] Verify link NOT shown for applications without interview_id or with interview.status != 'completed'

**TC9: Applications Page - Empty State**
- [ ] Delete or clear all applications for test user
- [ ] Navigate to /applications
- [ ] Verify empty state card displays
- [ ] Verify message: "No applications yet"
- [ ] Verify "Browse Jobs" button present
- [ ] Click button → verify navigation to /jobs page

**TC10: Error Handling**
- [ ] Stop backend server
- [ ] Reload /dashboard page
- [ ] Verify error message displays: "Error loading applications" or similar
- [ ] Verify retry button present
- [ ] Click "Retry" button → verify refetch attempted
- [ ] Restart backend server → retry should succeed and data loads
- [ ] Repeat for /applications page

**TC11: Visual Consistency**
- [ ] Compare new API-driven UI with old mock data UI side-by-side
- [ ] Verify card layouts identical:
  - [ ] Spacing between cards
  - [ ] Card padding and margins
  - [ ] Border styles and shadows
  - [ ] Typography (font sizes, weights, line heights)
- [ ] Verify badge styles match:
  - [ ] Colors for each status
  - [ ] Border radius
  - [ ] Padding
  - [ ] Icon sizes
- [ ] Verify button styles match existing design

**TC12: Responsive Design**
- [ ] Resize browser to 375px width (mobile viewport)
- [ ] Verify /dashboard layout stacks vertically on mobile
- [ ] Verify stats cards stack (1 column on mobile)
- [ ] Verify Recent Applications cards stack vertically
- [ ] Verify /applications page layout responsive:
  - [ ] Stats cards stack on mobile
  - [ ] Tabs remain accessible (no horizontal scroll)
  - [ ] Application cards stack and remain readable
- [ ] Resize back to desktop → verify layout expands correctly
- [ ] Test tablet viewport (768px) → verify 2-column grid for stats

**TC13: Performance and Loading States**
- [ ] Measure initial load time for /dashboard (should be < 2 seconds)
- [ ] Verify smooth transitions (no janky animations)
- [ ] Verify skeleton cards same dimensions as real cards (no layout shift)
- [ ] Change tabs on /applications page rapidly → verify no lag or flicker
- [ ] Verify React Query caching: navigate away and back → data loads from cache instantly

**TC14: React Query DevTools**
- [ ] Open React Query DevTools (bottom left corner)
- [ ] Navigate to /dashboard → verify query key: `['applications', 'me']`
- [ ] Verify query status: fetching → success
- [ ] Verify cached data visible in DevTools
- [ ] Navigate to /applications → verify same query reused (cache hit)
- [ ] Manually refetch in DevTools → verify API call made

## Dev Agent Record

### Agent Model Used
Claude 3.5 Sonnet (new) - Developer Agent (James)

### Debug Log References
None - Implementation completed without issues

### Completion Notes List
1. **API Integration Complete**: Successfully integrated with backend `GET /api/v1/applications/me` endpoint
2. **Type Safety**: All TypeScript interfaces match backend schemas exactly, no `any` types used
3. **Authentication**: Both dashboard and applications pages protected with authentication checks and redirects
4. **Loading States**: Implemented skeleton loaders for both pages to prevent layout shift
5. **Error Handling**: Added error states with retry buttons for API failures
6. **Empty States**: Added friendly empty states when no applications exist
7. **Interview Results Link**: Conditionally displays "View Interview Results" button when interview is completed
8. **Status Badges**: Preserved existing color scheme and styling for status badges
9. **Helper Functions**: Created date formatting and status config functions for consistent display
10. **Responsive Design**: Maintained existing responsive layouts and mobile support
11. **Code Quality**: Successfully built with `npm run build`, no TypeScript or linting errors
12. **Backend Schema Note**: JobPostingBasicResponse doesn't include salary fields, so displayed work_setup and employment_type instead

### File List
**Created:**
- `frontend/hooks/use-applications.ts` - Custom React Query hook for fetching applications

**Modified:**
- `frontend/lib/api-client.ts` - Added Application types, interfaces, and API functions
- `frontend/app/dashboard/page.tsx` - Replaced mock data with real API integration
- `frontend/app/applications/page.tsx` - Complete replacement with API integration

**Configuration (Verified Existing):**
- `frontend/.env.local` - Contains NEXT_PUBLIC_API_BASE_URL

### Status
Ready for Manual Testing (Task 9)

## QA Results
_To be filled by QA agent after implementation review and testing_

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-11-05 | 1.0 | Initial story draft created for dashboard and applications page update | SM Agent (Bob) |
| 2025-11-05 | 1.1 | Fixed API response schema mismatch (array vs object), clarified interview status field path, updated epic reference, added helper function examples | PO Agent (Sarah) |

---

**Epic:** Epic 03: Job-Driven AI Interview Flow (PRD: docs/prds/08-job-driven-interview-flow.md)  
**Dependencies:** Story 3.5 (Application REST API Endpoints - COMPLETED ✅), Story 3.7 (Frontend Job Browsing Page Update - COMPLETED ✅)  
**Blocks:** Story 3.9 (Frontend Application Submission Flow)

---
